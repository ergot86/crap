#include <windows.h>
#include <winnt.h>
#include <wininet.h>
#include <stdio.h>

typedef HMODULE (WINAPI *TLoadLibraryA)(LPCSTR);
typedef FARPROC (WINAPI *TGetProcAddress)(HMODULE, LPCSTR);
typedef int (WINAPI *TMessageBox)(HWND, LPCTSTR, LPCTSTR, UINT);

struct APIS
{
    TLoadLibraryA pLoadLibrary;
    TGetProcAddress pGetProcAddress;
    TMessageBox pMessageBox;
};

DWORD WINAPI Start(LPVOID lpParameter)
{
	struct APIS api;
	HANDLE h = NULL;

	api.pLoadLibrary = ((FARPROC *)lpParameter)[-3];	
	api.pGetProcAddress = ((FARPROC *)lpParameter)[-2];
	h = api.pLoadLibrary("user32.dll");
	api.pMessageBox = (TMessageBox)api.pGetProcAddress(h,"MessageBoxA");
	api.pMessageBox(0,"YES!","caca",MB_OK);

	return 1;
}
